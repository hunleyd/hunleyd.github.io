<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>pgBackRest 2.07 and macOS Mojave &#8211; Douglas J Hunley</title>
<meta name="description" content="It's not that I'm anti-social; I'm just not user-friendly">
<meta name="keywords" content="postgresql, pgbackrest, osx">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="/images/db.jpg">

<meta name="twitter:title" content="pgBackRest 2.07 and macOS Mojave">
<meta name="twitter:description" content="It's not that I'm anti-social; I'm just not user-friendly">
<meta name="twitter:creator" content="@hunleyd">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="pgBackRest 2.07 and macOS Mojave">
<meta property="og:description" content="It's not that I'm anti-social; I'm just not user-friendly">
<meta property="og:url" content="/posts/pgBackRest-2.07-and-macOS-Mojave/">
<meta property="og:site_name" content="Douglas J Hunley">





<link rel="canonical" href="/posts/pgBackRest-2.07-and-macOS-Mojave/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Douglas J Hunley Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<NAV id="dl-menu" class="dl-menuwrapper" role="navigation">
  <BUTTON class="dl-trigger">
    Open Menu
  </BUTTON>
  <UL class="dl-menu">
    <LI>
      <A href="/">Home</A>
    </LI>
    <LI>
      <A href="#">About</A>
      <UL class="dl-submenu">
        <LI>
          <IMG src="/images/avatar.jpg" alt="Douglas J Hunley photo" class="author-photo" />
          <H4>Douglas J Hunley</H4>
          <P>Linux Sys Admin, Gentoo user, PostgreSQL advocate, Android fanboi, OSS supporter, PlayStation gamer</P>
        </LI>
        <LI>
          <A href="/about/"><SPAN class="btn btn-inverse">Learn More</SPAN></A>
        </LI>
        
          <LI>
            <A href="https://dhunley.deviantart.com"><I class="fa fa-deviantart" aria-hidden="true"></I> DeviantArt</A>
          </LI>
        
        
          <LI>
            <A href="mailto:douglas.hunley@gmail.com"><I class="fa fa-envelope" aria-hidden="true"></I> Email</A>
          </LI>
        
        
          <LI>
            <A href="https://facebook.com/douglas.j.hunley"><I class="fa fa-facebook" aria-hidden="true"></I> Facebook</A>
          </LI>
        
        
        
          <LI>
            <A href="https://github.com/hunleyd"><I class="fa fa-github" aria-hidden="true"></I> GitHub</A>
          </LI>
        
        
          <LI>
            <A href="https://google.com/+DouglasHunley"><I class="fa fa-google-plus" aria-hidden="true"></I> Google+</A>
          </LI>
        
        
          <LI>
            <A href="https://instagram.com/doughunley"><I class="fa fa-instagram" aria-hidden="true"></I> Instagram</A>
          </LI>
        
        
          <LI>
            <A href="https://linkedin.com/in/dhunley"><I class="fa fa-linkedin" aria-hidden="true"></I> LinkedIn</A>
          </LI>
        
        
          <LI>
            <A href="https://meetup.com/members/43608152"><I class="fa fa-meetup" aria-hidden="true"></I> MeetUp</A>
          </LI>
        
        
          <LI>
            <A href="https://reddit.com/u/hunleyd"><I class="fa fa-reddit-alien" aria-hidden="true"></I> Reddit</A>
          </LI>
        
        
        
        
          <LI>
            <A href="https://twitter.com/hunleyd"><I class="fa fa-twitter" aria-hidden="true"></I> Twitter</A>
          </LI>
        
        
          <LI>
            <A href="https://youtube.com/user/doughunley"><I class="fa fa-youtube" aria-hidden="true"></I> YouTube</A>
          </LI>
        
      </UL><!-- /.dl-submenu -->
    </LI>
    <LI>
      <A href="#">Posts</A>
      <UL class="dl-submenu">
        <LI>
          <A href="/posts/">All Posts</A>
        </LI>
        <LI>
          <A href="/tags/">All Tags</A>
        </LI>
      </UL>
    </LI>
    
  </UL><!-- /.dl-menu -->
</NAV><!-- /.dl-menuwrapper -->



<div class="entry-header">
  
  <div class="entry-image">
    <img src="/images/db.jpg" alt="pgBackRest 2.07 and macOS Mojave">
  </div><!-- /.entry-image -->
</div><!-- /.entry-header -->


<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/posts/pgBackRest-2.07-and-macOS-Mojave/" rel="bookmark" title="pgBackRest 2.07 and macOS Mojave">pgBackRest 2.07 and macOS Mojave</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2018-11-16T06:12:31-05:00">November 16, 2018</time></span></h2>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~3 minutes
        </p><!-- /.entry-reading-time -->
        
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>pgBackRest 2.07 was <a href="https://twitter.com/pgBackRest/status/1063458495700320258">announced</a> today. As usual, I immediately downloaded it and tried to get it up and running on my MacBook (currently running Mojave). It wasn’t as straightforward as one might hope, and the online instructions assume a <em>Linux</em> system, so I figured I’d write this up for anyone else attempting the same.</p>

<p>Since this is OSX, we have to do some work to make things right before we even start with the pgBackRest code. First up, get a real OpenSSL install. We’ll use <a href="https://brew.sh">Homebrew</a> for this:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> brew <span class="nb">install </span>openssl
<span class="o">[</span>output snipped]
<span class="o">&gt;</span> openssl version <span class="nt">-a</span>
LibreSSL 2.6.4
built on: <span class="nb">date </span>not available
platform: information not available
options:  bn<span class="o">(</span>64,64<span class="o">)</span> rc4<span class="o">(</span>ptr,int<span class="o">)</span> des<span class="o">(</span>idx,cisc,16,int<span class="o">)</span> blowfish<span class="o">(</span>idx<span class="o">)</span>
compiler: information not available
OPENSSLDIR: <span class="s2">"/private/etc/ssl"</span>
<span class="o">&gt;</span> /usr/local/opt/openssl/bin/openssl version <span class="nt">-a</span>
OpenSSL 1.0.2p  14 Aug 2018
built on: reproducible build, <span class="nb">date </span>unspecified
platform: darwin64-x86_64-cc
options:  bn<span class="o">(</span>64,64<span class="o">)</span> rc4<span class="o">(</span>ptr,int<span class="o">)</span> des<span class="o">(</span>idx,cisc,16,int<span class="o">)</span> idea<span class="o">(</span>int<span class="o">)</span> blowfish<span class="o">(</span>idx<span class="o">)</span>
compiler: clang <span class="nt">-I</span><span class="nb">.</span> <span class="nt">-I</span>.. <span class="nt">-I</span>../include  <span class="nt">-fPIC</span> <span class="nt">-fno-common</span> <span class="nt">-DOPENSSL_PIC</span> <span class="nt">-DOPENSSL_THREADS</span> <span class="nt">-D_REENTRANT</span> <span class="nt">-DDSO_DLFCN</span> <span class="nt">-DHAVE_DLFCN_H</span> <span class="nt">-arch</span> x86_64 <span class="nt">-O3</span> <span class="nt">-DL_ENDIAN</span> <span class="nt">-Wall</span> <span class="nt">-DOPENSSL_IA32_SSE2</span> <span class="nt">-DOPENSSL_BN_ASM_MONT</span> <span class="nt">-DOPENSSL_BN_ASM_MONT5</span> <span class="nt">-DOPENSSL_BN_ASM_GF2m</span> <span class="nt">-DSHA1_ASM</span> <span class="nt">-DSHA256_ASM</span> <span class="nt">-DSHA512_ASM</span> <span class="nt">-DMD5_ASM</span> <span class="nt">-DAES_ASM</span> <span class="nt">-DVPAES_ASM</span> <span class="nt">-DBSAES_ASM</span> <span class="nt">-DWHIRLPOOL_ASM</span> <span class="nt">-DGHASH_ASM</span> <span class="nt">-DECP_NISTZ256_ASM</span>
OPENSSLDIR: <span class="s2">"/usr/local/etc/openssl"</span>
</code></pre></div></div>

<p>As you can see, the default SSL from OSX is in <code class="highlighter-rouge">/usr/bin</code> while the newly installed OpenSSL is in <code class="highlighter-rouge">/usr/local/opt/openssl</code>. In my testing, this is enough to proceed with pgBackRest but I prefer to have the <code class="highlighter-rouge">openssl</code> binary match the libs and I’m a glutton for punishment, so I replace the OSX binary with the Homebrew one:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">sudo mv</span> /usr/bin/openssl /usr/bin/openssl.old
<span class="o">&gt;</span> <span class="nb">sudo ln</span> <span class="nt">-s</span> /usr/local/opt/openssl/bin/openssl /usr/bin
<span class="o">&gt;</span> <span class="nb">ls</span> <span class="nt">-ld</span> /usr/bin/openssl<span class="k">*</span>
lrwxr-xr-x 1 root wheel   34 Nov 16 11:39 /usr/bin/openssl -&gt; /usr/local/opt/openssl/bin/openssl<span class="k">*</span>
<span class="nt">-rwxr-xr-x</span> 1 root wheel 1.2M Sep 21 00:16 /usr/bin/openssl.old<span class="k">*</span>
</code></pre></div></div>

<p>OK, so now we have an SSL that pgBackRest knows how to speak to. We need to install some Perl modules that it needs. If you haven’t run CPAN before, just accept the defaults when it asks you things:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> perl <span class="nt">-MCPAN</span> <span class="nt">-e</span> shell
cpan[1]&gt; <span class="nb">install </span>DBI
<span class="o">[</span>output snipped]
cpan[2]&gt; <span class="nb">install </span>DBD::Pg
<span class="o">[</span>output snipped]
cpan[3]&gt; <span class="nb">install </span>IO::Socket::SSL
<span class="o">[</span>output snipped]
cpan[4]&gt; <span class="nb">install </span>XML::LibXML
<span class="o">[</span>output snipped]
cpan[5]&gt; q
</code></pre></div></div>

<p>Now we’ve got our Perl modules installed, we have to tell our shell where to find them:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">export </span><span class="nv">PERL5LIB</span><span class="o">=</span>/Users/doug/perl5/lib/perl5
<span class="o">&gt;</span> <span class="nb">export </span><span class="nv">PERL_LOCAL_LIB_ROOT</span><span class="o">=</span>/Users/doug/perl5
<span class="o">&gt;</span> <span class="nb">export </span><span class="nv">PERL_MB_OPT</span><span class="o">=</span><span class="nt">--install_base</span> <span class="s2">"/Users/doug/perl5"</span>
<span class="o">&gt;</span> <span class="nb">export </span><span class="nv">PERL_MM_OPT</span><span class="o">=</span><span class="nv">INSTALL_BASE</span><span class="o">=</span>/Users/doug/perl5
</code></pre></div></div>

<p>Obviously, you will change ‘doug’ to your OSX username. You will also need to add these to your shell’s startup file (<code class="highlighter-rouge">.profile</code>, <code class="highlighter-rouge">.bash_profile</code>, etc) to make them permanent.</p>

<p>Now, we can actually get down to the business of compiling and installing pgBackRest. Download the 2.07 tarball from the releases tab on GitHub, and let’s get busy:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> <span class="nb">tar </span>xvf Downloads/pgbackrest-release-2.07.tar.gz
<span class="o">[</span>output snipped]
<span class="o">&gt;</span> <span class="nb">cd </span>pgbackrest-release-2.07
</code></pre></div></div>

<p>Now, we need to make some edits to the included Makefile. So <code class="highlighter-rouge">vi src/Makefile</code> and jump to line 42. Edit this line to be:</p>

<div class="language-make highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LDEXTRA</span> <span class="o">=</span> <span class="nt">-L</span> /usr/local/opt/openssl/lib
</code></pre></div></div>

<p>This tells the build process where to find the OpenSSL that we installed. Then, jump to line 149 and change it to:</p>

<div class="language-make highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="err">install</span> <span class="err">-m</span> <span class="err">755</span> <span class="err">pgbackrest</span> <span class="err">$(DESTDIR)/usr/local/bin</span>
</code></pre></div></div>

<p>This makes it install into <code class="highlighter-rouge">/usr/local/bin</code> which is where Homebrew puts everything else and you shouldn’t need to use <code class="highlighter-rouge">sudo</code> to write to it.</p>

<p>Now, compile and install it:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> make <span class="nt">-s</span> <span class="nt">-C</span> ./src <span class="o">&amp;&amp;</span> make <span class="nt">-s</span> <span class="nt">-C</span> ./src/install
</code></pre></div></div>

<p>Assuming that goes well, you can now run pgBackRest to verify it’s installed and functional:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;</span> /usr/local/bin/pgbackrest
pgBackRest 2.07 - General <span class="nb">help

</span>Usage:
    pgbackrest <span class="o">[</span>options] <span class="o">[</span><span class="nb">command</span><span class="o">]</span>

Commands:
    archive-get     Get a WAL segment from the archive.
    archive-push    Push a WAL segment to the archive.
    backup          Backup a database cluster.
    check           Check the configuration.
    expire          Expire backups that exceed retention.
    <span class="nb">help            </span>Get help.
    info            Retrieve information about backups.
    restore         Restore a database cluster.
    stanza-create   Create the required stanza data.
    stanza-delete   Delete a stanza.
    stanza-upgrade  Upgrade a stanza.
    start           Allow pgBackRest processes to run.
    stop            Stop pgBackRest processes from running.
    version         Get version.

Use <span class="s1">'pgbackrest help [command]'</span> <span class="k">for </span>more information.
</code></pre></div></div>

<p>You should now be able to follow the online docs and setup pgBackRest.</p>

<p>Enjoy!</p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/tags/#postgresql" title="Pages tagged postgresql" class="tag"><span class="term">postgresql</span></a><a href="/tags/#pgbackrest" title="Pages tagged pgbackrest" class="tag"><span class="term">pgbackrest</span></a><a href="/tags/#osx" title="Pages tagged osx" class="tag"><span class="term">osx</span></a></span>
        
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/posts/pgBackRest-2.07-and-macOS-Mojave/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/posts/pgBackRest-2.07-and-macOS-Mojave/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/posts/pgBackRest-2.07-and-macOS-Mojave/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
    <div class="read-more">
  
    <div class="read-more-header">
      <a href="/posts/Monitoring-pgBackRest-with-tail_n_mail/" class="read-more-btn">Read More</a>
    </div><!-- /.read-more-header -->
    <div class="read-more-content">
      <h3><a href="/posts/Monitoring-pgBackRest-with-tail_n_mail/" title="Monitoring pgBackRest with tail_n_mail">Monitoring pgBackRest with tail_n_mail</a></h3>
      <p>After a lively discussion at work today about monitoring tools and uses cases, I decided to see if I could use tail_n_mail, which I alrea...&hellip; <a href="/posts/Monitoring-pgBackRest-with-tail_n_mail/">Continue reading</a></p>
    </div><!-- /.read-more-content -->
  
  <div class="read-more-list">
    
      <div class="list-item">
        <h4><a href="/posts/pgBouncer-and-auth-pass-thru/" title="pgBouncer and auth pass-thru">pgBouncer and auth pass-thru</a></h4>
        <span>Published on August 07, 2018</span>
      </div><!-- /.list-item -->
    
      <div class="list-item">
        <h4><a href="/posts/Locking-it-down/" title="Locking it down">Locking it down</a></h4>
        <span>Published on June 18, 2018</span>
      </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->
</div><!-- /.read-more -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2018 Douglas J Hunley.<BR /><FONT size=-1>Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a>. Served via <a href="https://github.com">GitHub</a>. Themed using <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR</a>.</FONT></span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>




    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'douglashunley'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	        

</body>
</html>

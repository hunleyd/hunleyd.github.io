<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Doug's Dabblings &middot; Quick thoughts on stuff I'm playing with
    
  </title>

  
  <link rel="canonical" href="/page17/">
  

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  
<!-- font awesome -->
<script src="https://kit.fontawesome.com/89f4c31870.js" crossorigin="anonymous"></script>
</head>


  <body class="theme-base-0d">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A collection of thoughts on things in my life that I'm experiencing, playing with, or suffering through. Mostly tech related, but sometimes not.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item " href="/posts/">All Posts</a>
    <a class="sidebar-nav-item " href="/tags/">All Tags</a>
  </nav>

  <div class="sidebar-item">
      <a href="https://www.deviantart.com/dhunley"><i class="fab fa-deviantart"></i></a>
    <a href="mailto:doug.hunley@gmail.com"><i class="fas fa-envelope"></i></a>
      <a href="https://github.com/hunleyd"><i class="fab fa-github"></i></a>
      <a href="https://instagram.com/doughunley"><i class="fab fa-instagram-square"></i></a>
      <a href="https://last.fm/user/hunleyd"><i class="fab fa-lastfm-square"></i></a>
      <a href="https://www.linkedin.com/in/dhunley"><i class="fab fa-linkedin"></i></a>
      <a href="https://www.meetup.com/members/43608152/"><i class="fab fa-meetup"></i></a>
      <a href="https://reddit.com/u/hunleyd"><i class="fab fa-reddit-square"></i></a>
      <a href="https://https://open.spotify.com/user/z0emrjhe6h1bieo81fkrmdbqq"><i class="fab fa-spotify"></i></a>
      <a href="https://twitter.com/hunleyd"><i class="fab fa-twitter-square"></i></a>
      <a href="https://youtube.com/c/DouglasHunley"><i class="fab fa-youtube"></i></a>
    <p></p>
    <p>
      <a href="/atom.xml"><i class="fas fa-rss-square"></i></a>
    </p>
    <p></p>
    <p>
      &copy; 2021. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Doug's Dabblings</a>
            <small>Quick thoughts on stuff I'm playing with</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2017/07/25/When-you-cannot-get-there-from-here/">
        When you cannot get there from here
      </a>
    </h1>

    <span class="post-date">25 Jul 2017</span>

    <p>Connecting to a PostgreSQL instance isn’t hard generally, but sometimes you can run into issues. Sometimes a port isn’t open on a firewall, or the server is in a VLAN that you can’t get to, or perhaps the server isn’t running on the network interface you think it is. More commonly, you can reach the PostgreSQL instance but you’re connection isn’t authorized (which is not the same as being unable to <em>authenticate</em>). Fortunately, the error messages returned in these different failure scenarios are fairly verbose and distinct so you can easily tell which scenario you’re facing. Let’s dive into each scenario and see what the error looks like, shall we?</p>

<h4 id="scenario-1---bad-password">Scenario 1 - Bad password</h4>

<p>Let’s first assume that everything is working and you <em>can</em> actually connect to the PostgreSQL instance, but you can’t authenticate. The error will look like this:</p>

<p><img src="/images/posts/authentication.png" alt="auth failed" /></p>

<p>As you can see, the message makes it pretty clear that you were able to connect, but your credentials were wrong (you were <em>authorized</em> to connect, but failed to <em>authenticate</em>). Did you type the password incorrectly? Is there a <code class="language-plaintext highlighter-rouge">~/.pgpass</code> <a href="https://www.postgresql.org/docs/current/static/libpq-pgpass.html">file</a> that is providing the password for you? Do you have <code class="language-plaintext highlighter-rouge">$PGPASSWORD</code> defined in your <a href="https://www.postgresql.org/docs/current/static/libpq-envars.html">environment</a>? Fix the password being passed to PostgreSQL, and you won’t have further issues in this scenario.</p>

<h4 id="scenario-2---pg_hbaconf-rejects-you">Scenario 2 - pg_hba.conf rejects you</h4>

<p>For our second scenario, we’re going to assume that you <em>can</em> actually connect to the PostgreSQL instance, but there is an entry in <code class="language-plaintext highlighter-rouge">pg_hba.conf</code> denying you access. First, we’ll try connecting via a local Unix socket:</p>

<p><img src="/images/posts/reject_socket.png" alt="reject socket" /></p>

<p>As you can see, it straight up tells you that you have been <em>explicitly denied access</em>. It may be rejecting connections via Unix sockets completely, or it may be rejecting connection as the specified user via Unix socket, or it may be rejecting connections to the specified database via Unix sock. You could determine which of these scenarios is true by trying a different user on the same database and then trying the same user on a different database. In any case, the problem <em>is not</em> networking or firewall related. The DBA needs to adjust <code class="language-plaintext highlighter-rouge">pg_hba.conf</code> to allow connections of this type, or you need to connect via a TCP port instead of a Unix socket. Discuss with your DBA.</p>

<p>Now, let’s try via a TCP port:</p>

<p><img src="/images/posts/reject_port.png" alt="reject port" /></p>

<p>Again, you can see that it pretty plainly tells you that you have been <em>explicitly denied</em>. In this case though, it may be rejecting your IP address specifically, your entire network segment, your id, that database, or the fact that you didn’t make an SSL connection. You can whittle this down by trying a different user on the same db, trying the same user on a different db, or switching to an SSL connection and repeating these tests. (I assume that you can’t change your IP address. But perhaps you could make the same test cases from another computer). Again, you’ll probably need the DBA to resolve this with you.</p>

<h4 id="scenario-3---pg_hbaconf-doesnt-allow-you">Scenario 3 - pg_hba.conf doesn’t allow you</h4>

<p>I know what you’re thinking. “Isn’t this the same as above?”. And the answer is “no it is not”. Above, the <code class="language-plaintext highlighter-rouge">pg_hba.conf</code> file had an entry that matched your incoming connection and said to <strong>explicitly</strong> reject it. In this scenario, there is <em>no entry that matches your connection</em> and you end up <strong>implicitly</strong> denied.</p>

<p>Again, we’ll start by using a Unix socket:</p>

<p><img src="/images/posts/noentry_socket.png" alt="no entry socket" /></p>

<p>Once more, the message pretty clearly tells you what is wrong. As it says, <em>there is no entry in <code class="language-plaintext highlighter-rouge">pg_hba.conf</code> that matches your incoming connection</em>. And since PostgreSQL tries to err on the side of caution, when it can’t find an entry stating definitively what to do, it rejects you. The same troubleshooting steps as above apply (change the user/db, etc). And also like above, the DBA is going to need to edit <code class="language-plaintext highlighter-rouge">pg_hba.conf</code> to add an entry for your connection.</p>

<p>Now, what does it look like over a TCP port:</p>

<p><img src="/images/posts/noentry_port.png" alt="no entry port" /></p>

<p>It’s the same error message as above but showing your IP address instead of <code class="language-plaintext highlighter-rouge">[local]</code>. And the same debugging applies. Once again, the DBA will need to add an entry to <code class="language-plaintext highlighter-rouge">pg_hba.conf</code> to resolve this.</p>

<h4 id="scenario-4---everything-else-no-really">Scenario 4 - everything else (no, really)</h4>

<p>By default, PostgreSQL listens for connections on port 5432. Sometimes, your DBA (or your vendor) has chosen to run PostgreSQL on a different port for some reason. If you are not trying to connect to the correct port, you’ll get an error from <code class="language-plaintext highlighter-rouge">psql</code>.</p>

<p>If you were trying to connect via a Unix socket, you’ll see:</p>

<p><img src="/images/posts/socket_nope.png" alt="socket nope" /></p>

<p>If you were trying a TCP port connection, you’d see:</p>

<p><img src="/images/posts/port_nope.png" alt="port nope" /></p>

<p>This error indicates that it cannot establish a network connection with PostgreSQL at the IP address (or UNix socket) you specified on the default port. Check to make sure you don’t have <code class="language-plaintext highlighter-rouge">$PGPORT</code> set incorrectly in your environment.</p>

<p>If you <em>are</em> using the correct port, and you still see one of two errors above, then the issue will be one of the following:</p>

<ul>
  <li>PostgreSQL isn’t running</li>
  <li>PostgreSQL is running, but on a different IP address than you’re trying to connect to</li>
  <li>PostgreSQL is running, but you cannot establish a network connection from here to there</li>
</ul>

<p>If PostgreSQL isn’t running, talk to your DBA about why (maybe it died, maybe it’s a maintenance window). If you are affected by the 2<sup>nd</sup> bullet item, you’ll have to talk with your DBA about the proper IP address to use when connecting. Note that, by default, PostgreSQL only listens on <code class="language-plaintext highlighter-rouge">localhost</code> and none of your other interfaces. If this hasn’t been changed (<code class="language-plaintext highlighter-rouge">listen_addresses</code> in <code class="language-plaintext highlighter-rouge">postgresql.conf</code>) then you’ll fall into this failure category. And if you’re plagued by the 3<sup>rd</sup> bullet item, you’ll have to talk to your network admin (and probably your DBA) as there may be a firewall blocking you, or your VLAN can’t connect to the other VLAN, or some other layer 3/4 tomfoolery.</p>

<p>So now you know all the (common) ways that connecting to PostgreSQL can fail and how to distinguish between them. With just a little bit of knowledge, you can communicate exactly what is happening to your DBA and make it easier for him/her to rectify the issue. Go forth, and happy PostgreSQL-ing.</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page18">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page16">Newer</a>
    
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>

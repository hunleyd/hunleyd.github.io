<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Doug's Dabblings &middot; Quick thoughts on stuff I'm playing with
    
  </title>

  
  <link rel="canonical" href="/page9/">
  

  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  
  <!-- font awesome -->
  <script src="https://kit.fontawesome.com/89f4c31870.js" crossorigin="anonymous"></script>
</head>


  <body class="theme-base-0d">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A collection of thoughts on things in my life that I'm experiencing, playing with, or suffering through. Mostly tech related, but sometimes not.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <a class="sidebar-nav-item " href="/posts/">All Posts</a>
    <a class="sidebar-nav-item " href="/tags/">All Tags</a>
  </nav>

  <div class="sidebar-item">
      <a href="https://www.deviantart.com/dhunley"><i class="fab fa-deviantart"></i></a>
    <a href="mailto:%64%6F%75%67.%68%75%6E%6C%65%79@%67%6D%61%69%6C.%63%6F%6D"><i class="fas fa-envelope"></i></a>
      <a href="https://github.com/hunleyd"><i class="fab fa-github"></i></a>
      <a href="https://instagram.com/doughunley"><i class="fab fa-instagram-square"></i></a>
      <a href="https://last.fm/user/hunleyd"><i class="fab fa-lastfm-square"></i></a>
      <a href="https://www.linkedin.com/in/dhunley"><i class="fab fa-linkedin"></i></a>
      <a href="https://www.meetup.com/members/43608152/"><i class="fab fa-meetup"></i></a>
      <a href="https://reddit.com/u/hunleyd"><i class="fab fa-reddit-square"></i></a>
      <a href="https://https://open.spotify.com/user/z0emrjhe6h1bieo81fkrmdbqq"><i class="fab fa-spotify"></i></a>
      <a href="https://twitter.com/hunleyd"><i class="fab fa-twitter-square"></i></a>
      <a href="https://youtube.com/c/DouglasHunley"><i class="fab fa-youtube"></i></a>
    <p></p>
    <p>
      <a href="/atom.xml"><i class="fas fa-rss-square"></i></a>
    </p>
    <p></p>
    <p>
      &copy; 2021. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Doug's Dabblings</a>
            <small>Quick thoughts on stuff I'm playing with</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2018/11/16/pgBackRest-2.07-and-macOS-Mojave/">
        pgBackRest 2.07 and macOS Mojave
      </a>
    </h1>

    <span class="post-date">16 Nov 2018</span>

    <p>pgBackRest 2.07 was <a href="https://twitter.com/pgBackRest/status/1063458495700320258">announced</a> today. As usual, I immediately downloaded it and tried to get it up and running on my MacBook (currently running Mojave). It wasn’t as straightforward as one might hope, and the online instructions assume a <em>Linux</em> system, so I figured I’d write this up for anyone else attempting the same.</p>

<p>Since this is OSX, we have to do some work to make things right before we even start with the pgBackRest code. First up, get a real OpenSSL install. We’ll use <a href="https://brew.sh">Homebrew</a> for this:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>brew <span class="nb">install </span>openssl
<span class="o">[</span>output snipped]
<span class="nv">$ </span>openssl version <span class="nt">-a</span>
LibreSSL 2.6.4
built on: <span class="nb">date </span>not available
platform: information not available
options:  bn<span class="o">(</span>64,64<span class="o">)</span> rc4<span class="o">(</span>ptr,int<span class="o">)</span> des<span class="o">(</span>idx,cisc,16,int<span class="o">)</span> blowfish<span class="o">(</span>idx<span class="o">)</span>
compiler: information not available
OPENSSLDIR: <span class="s2">"/private/etc/ssl"</span>
<span class="nv">$ </span>/usr/local/opt/openssl/bin/openssl version <span class="nt">-a</span>
OpenSSL 1.0.2p  14 Aug 2018
built on: reproducible build, <span class="nb">date </span>unspecified
platform: darwin64-x86_64-cc
options:  bn<span class="o">(</span>64,64<span class="o">)</span> rc4<span class="o">(</span>ptr,int<span class="o">)</span> des<span class="o">(</span>idx,cisc,16,int<span class="o">)</span> idea<span class="o">(</span>int<span class="o">)</span> blowfish<span class="o">(</span>idx<span class="o">)</span>
compiler: clang <span class="nt">-I</span><span class="nb">.</span> <span class="nt">-I</span>.. <span class="nt">-I</span>../include  <span class="nt">-fPIC</span> <span class="nt">-fno-common</span> <span class="nt">-DOPENSSL_PIC</span> <span class="nt">-DOPENSSL_THREADS</span> <span class="nt">-D_REENTRANT</span> <span class="nt">-DDSO_DLFCN</span> <span class="nt">-DHAVE_DLFCN_H</span> <span class="nt">-arch</span> x86_64 <span class="nt">-O3</span> <span class="nt">-DL_ENDIAN</span> <span class="nt">-Wall</span> <span class="nt">-DOPENSSL_IA32_SSE2</span> <span class="nt">-DOPENSSL_BN_ASM_MONT</span> <span class="nt">-DOPENSSL_BN_ASM_MONT5</span> <span class="nt">-DOPENSSL_BN_ASM_GF2m</span> <span class="nt">-DSHA1_ASM</span> <span class="nt">-DSHA256_ASM</span> <span class="nt">-DSHA512_ASM</span> <span class="nt">-DMD5_ASM</span> <span class="nt">-DAES_ASM</span> <span class="nt">-DVPAES_ASM</span> <span class="nt">-DBSAES_ASM</span> <span class="nt">-DWHIRLPOOL_ASM</span> <span class="nt">-DGHASH_ASM</span> <span class="nt">-DECP_NISTZ256_ASM</span>
OPENSSLDIR: <span class="s2">"/usr/local/etc/openssl"</span>
</code></pre></div></div>

<p>As you can see, the default SSL from OSX is in <code class="language-plaintext highlighter-rouge">/usr/bin</code> while the newly installed OpenSSL is in <code class="language-plaintext highlighter-rouge">/usr/local/opt/openssl</code>. In my testing, this is enough to proceed with pgBackRest but I prefer to have the <code class="language-plaintext highlighter-rouge">openssl</code> binary match the libs and I’m a glutton for punishment, so I replace the OSX binary with the Homebrew one:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo mv</span> /usr/bin/openssl /usr/bin/openssl.old
<span class="nv">$ </span><span class="nb">sudo ln</span> <span class="nt">-s</span> /usr/local/opt/openssl/bin/openssl /usr/bin
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-ld</span> /usr/bin/openssl<span class="k">*</span>
lrwxr-xr-x 1 root wheel   34 Nov 16 11:39 /usr/bin/openssl -&amp;gt<span class="p">;</span> /usr/local/opt/openssl/bin/openssl<span class="k">*</span>
<span class="nt">-rwxr-xr-x</span> 1 root wheel 1.2M Sep 21 00:16 /usr/bin/openssl.old<span class="k">*</span>
</code></pre></div></div>

<p>OK, so now we have an SSL that pgBackRest knows how to speak to. We need to install some Perl modules that it needs. If you haven’t run CPAN before, just accept the defaults when it asks you things:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>perl <span class="nt">-MCPAN</span> <span class="nt">-e</span> shell
cpan[1]&gt; <span class="nb">install </span>DBI
<span class="o">[</span>output snipped]
cpan[2]&gt; <span class="nb">install </span>DBD::Pg
<span class="o">[</span>output snipped]
cpan[3]&gt; <span class="nb">install </span>IO::Socket::SSL
<span class="o">[</span>output snipped]
cpan[4]&gt; <span class="nb">install </span>XML::LibXML
<span class="o">[</span>output snipped]
cpan[5]&gt; q
</code></pre></div></div>

<p>Now we’ve got our Perl modules installed, we have to tell our shell where to find them:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">PERL5LIB</span><span class="o">=</span>/Users/doug/perl5/lib/perl5
<span class="nv">$ </span><span class="nb">export </span><span class="nv">PERL_LOCAL_LIB_ROOT</span><span class="o">=</span>/Users/doug/perl5
<span class="nv">$ </span><span class="nb">export </span><span class="nv">PERL_MB_OPT</span><span class="o">=</span><span class="nt">--install_base</span> <span class="s2">"/Users/doug/perl5"</span>
<span class="nv">$ </span><span class="nb">export </span><span class="nv">PERL_MM_OPT</span><span class="o">=</span><span class="nv">INSTALL_BASE</span><span class="o">=</span>/Users/doug/perl5
</code></pre></div></div>

<p>Obviously, you will change ‘doug’ to your OSX username. You will also need to add these to your shell’s startup file (<code class="language-plaintext highlighter-rouge">.profile</code>, <code class="language-plaintext highlighter-rouge">.bash_profile</code>, etc) to make them permanent.</p>

<p>Now, we can actually get down to the business of compiling and installing pgBackRest. Download the 2.07 tarball from the releases tab on GitHub, and let’s get busy:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">tar </span>xvf Downloads/pgbackrest-release-2.07.tar.gz
<span class="o">[</span>output snipped]
<span class="nv">$ </span><span class="nb">cd </span>pgbackrest-release-2.07
</code></pre></div></div>

<p>Now, we need to make some edits to the included Makefile. So <code class="language-plaintext highlighter-rouge">vi src/Makefile</code> and jump to line 42. Edit this line to be:</p>

<div class="language-make highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">LDEXTRA</span> <span class="o">=</span> <span class="nt">-L</span> /usr/local/opt/openssl/lib
</code></pre></div></div>

<p>This tells the build process where to find the OpenSSL that we installed. Then, jump to line 149 and change it to:</p>

<div class="language-make highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="err">install</span> <span class="err">-m</span> <span class="err">755</span> <span class="err">pgbackrest</span> <span class="err">$(DESTDIR)/usr/local/bin</span>
</code></pre></div></div>

<p>This makes it install into <code class="language-plaintext highlighter-rouge">/usr/local/bin</code> which is where Homebrew puts everything else and you shouldn’t need to use <code class="language-plaintext highlighter-rouge">sudo</code> to write to it.</p>

<p>Now, compile and install it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make <span class="nt">-s</span> <span class="nt">-C</span> ./src &amp;amp<span class="p">;</span>&amp;amp<span class="p">;</span> make <span class="nt">-s</span> <span class="nt">-C</span> ./src/install
</code></pre></div></div>

<p>Assuming that goes well, you can now run pgBackRest to verify it’s installed and functional:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>/usr/local/bin/pgbackrest
pgBackRest 2.07 - General <span class="nb">help

</span>Usage:
    pgbackrest <span class="o">[</span>options] <span class="o">[</span><span class="nb">command</span><span class="o">]</span>

Commands:
    archive-get     Get a WAL segment from the archive.
    archive-push    Push a WAL segment to the archive.
    backup          Backup a database cluster.
    check           Check the configuration.
    expire          Expire backups that exceed retention.
    <span class="nb">help            </span>Get help.
    info            Retrieve information about backups.
    restore         Restore a database cluster.
    stanza-create   Create the required stanza data.
    stanza-delete   Delete a stanza.
    stanza-upgrade  Upgrade a stanza.
    start           Allow pgBackRest processes to run.
    stop            Stop pgBackRest processes from running.
    version         Get version.

Use <span class="s1">'pgbackrest help [command]'</span> <span class="k">for </span>more information.
</code></pre></div></div>

<p>You should now be able to follow the online docs and setup pgBackRest.</p>

<p>Enjoy!</p>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page10">Older</a>
  
  
    
      <a class="pagination-item newer" href="/page8">Newer</a>
    
  
</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
